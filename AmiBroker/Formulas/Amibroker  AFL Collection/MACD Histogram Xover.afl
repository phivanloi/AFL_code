Shrt = Param("MACD Short MA",12,1,100,1);
Lng = Param("MACD Long MA",26,1,200,1);
Sig = Param("MACD Smoothing Period",9,1,50,1);
Time = Param("MACD Time Ratio",5,1,22,1);
Shrt1 = Shrt*Time;
Lng1 = Lng*Time;
Sig1 = Sig*Time;
f1 = 2/(Shrt1+1);
f2 = 2/(lng1+1);
f3 = 2/(Sig1+1);
mcd =  OscP(Shrt,lng);
Hist = mcd-EMA(mcd,Sig);
sigf = Ref(Hist,1-Time)/(1-f3)+EMA(mcd,Sig);
x =((1-f2)*EMA(Close,lng)-(1-f1)*EMA(Close,Shrt)+sigf)/(f1-f2);
Plot(x, "", colorRed);
PlotGrid(0, colorLightGrey);